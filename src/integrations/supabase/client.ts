
// This file is automatically generated. Do not edit it directly.
import { createClient } from '@supabase/supabase-js';
import type { Database } from './types';
import { AdminUserAttributes, AuthError, GenerateLinkParams, GenerateLinkResponse, GoTrueAdminApi, GoTrueAdminMFAApi, PageParams, Pagination, User, UserResponse } from '@supabase/supabase-js';

const SUPABASE_URL = "https://sbxltdbnqixucjoognfj.supabase.co";
const SUPABASE_PUBLISHABLE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNieGx0ZGJucWl4dWNqb29nbmZqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDYxNDQxMDksImV4cCI6MjA2MTcyMDEwOX0.ZsH2LX5JVFk7tCC0gGmjP1ZrVlQJ78nSUlMqxW7L1rw";

// Import the supabase client like this:
// import { supabase } from "@/integrations/supabase/client";

export const supabase = createClient<Database>(
  SUPABASE_URL, 
  SUPABASE_PUBLISHABLE_KEY,
  {
    auth: {
      persistSession: true,
      autoRefreshToken: true
    }
  }
);

// Define types for the admin functions we need to implement
interface AdminUserUpdateData {
  email?: string;
  password?: string;
  email_confirm?: boolean;
  user_metadata?: Record<string, any>;
}

// Implementation for admin API functions
// These functions use the appropriate Supabase API endpoints
const adminApiHeaders = {
  apikey: SUPABASE_PUBLISHABLE_KEY,
  Authorization: `Bearer ${SUPABASE_PUBLISHABLE_KEY}`,
  "Content-Type": "application/json"
};

// Custom admin API implementation
const adminApi = {
  async deleteUser(userId: string): Promise<UserResponse> {
    const response = await fetch(`${SUPABASE_URL}/auth/v1/admin/users/${userId}`, {
      method: 'DELETE',
      headers: adminApiHeaders
    });
    
    if (!response.ok) {
      const errorData = await response.json();
      const error: AuthError = {
        message: errorData.message || 'Failed to delete user',
        status: response.status
      };
      return { data: { user: null }, error };
    }
    
    return { data: { user: null }, error: null };
  },

  async createUser(attributes: AdminUserAttributes): Promise<UserResponse> {
    const response = await fetch(`${SUPABASE_URL}/auth/v1/admin/users`, {
      method: 'POST',
      headers: adminApiHeaders,
      body: JSON.stringify(attributes)
    });
    
    const responseData = await response.json();
    
    if (!response.ok) {
      const error: AuthError = {
        message: responseData.message || 'Failed to create user',
        status: response.status
      };
      return { data: { user: null }, error };
    }
    
    return { data: { user: responseData }, error: null };
  },

  async updateUserById(uid: string, attributes: AdminUserAttributes): Promise<UserResponse> {
    const response = await fetch(`${SUPABASE_URL}/auth/v1/admin/users/${uid}`, {
      method: 'PUT',
      headers: adminApiHeaders,
      body: JSON.stringify(attributes)
    });
    
    if (!response.ok) {
      const errorData = await response.json();
      const error: AuthError = {
        message: errorData.message || 'Failed to update user',
        status: response.status
      };
      return { data: { user: null }, error };
    }
    
    const userData = await response.json();
    return { data: { user: userData }, error: null };
  },

  // Stubbed methods to satisfy TypeScript interface
  _listFactors: async () => ({ data: null, error: null }),
  _deleteFactor: async () => ({ data: null, error: null }),
  signOut: async () => ({ data: null, error: null }),
  inviteUserByEmail: async () => ({ data: { user: null }, error: null }),
  generateLink: async () => ({ data: { properties: {}, user: null }, error: null }),
  listUsers: async () => ({ data: { users: [], aud: '', total_count: 0, next_page: '' }, error: null }),
  getUserById: async () => ({ data: { user: null }, error: null }),
  resetPasswordForEmail: async () => ({ data: {}, error: null }),
  
  // Properties required by interface
  mfa: {} as GoTrueAdminMFAApi,
  url: SUPABASE_URL,
  headers: adminApiHeaders,
  fetch: fetch.bind(window)
};

// Attach admin methods to the Supabase auth client
supabase.auth.admin = adminApi as GoTrueAdminApi;

// Add custom type for auth admin API
declare module '@supabase/supabase-js' {
  interface SupabaseAuthClient {
    admin: GoTrueAdminApi;
  }
}
